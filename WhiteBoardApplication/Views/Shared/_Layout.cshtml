<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>White Board Application</title>
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")

    @Scripts.Render("~/bundles/Generic")
    @Styles.Render("~/Content/literallycanvasCss")
    <script src="//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react-with-addons.js" type="text/javascript"></script>
    @Scripts.Render("~/bundles/LiterallycanvasJS")

    <script src="~/Scripts/app.js"></script>

</head>
<body>
   
  
    <div class="container body-content">
        @RenderBody()
        <hr />
        <footer>
            <p>&copy; @DateTime.Now.Year -White Board Application</p>
        </footer>
    </div>

    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">

        $(document).ready(function () {
            // Declare a proxy to reference the hub.
            var chat = $.connection.chatHub;
            // Create a function that the hub can call to broadcast messages.

            chat.client.broadcastMessage = function (name, myscreenshot,IsRealTime) {
                $("#spanName").show();
                $("#txtIsRealTime").val(IsRealTime);

                if ($("#txtUserName").val() != name) {
                    $('.my-drawing').mousedown(function (event) { event.preventDefault(); event.stopPropagation(); });
                }

                if (myscreenshot != '') {
                    lc.loadSnapshot(JSON.parse(myscreenshot));
                    if (IsRealTime == 1) {
                       
                        $("#spanName").text('' + name + ' is typing...');
                        lc.loadSnapshot(JSON.parse(myscreenshot));
                    }
                    else {
                        $("#spanName").text('' + name + ' has finished typing');
                    }
                }
                else {
                    $("#spanName").text('' + name + ' is typing...');
                }

            };
            // Get the user name and store it to prepend to messages.
            var UserName =prompt('Enter your name:', '');
           
            // Start the connection.
            if (UserName)
                $("#txtUserName").val(UserName)
            else
                $("#txtUserName").val("Anonymous")
         
            $('#displayname').text("Welcome " + $("#txtUserName").val());

            lc.on('drawEnd', function () {
                var IsRealTime = $("#txtIsRealTime").val();
                if (IsRealTime == 1) {
                     var myscreenshot = lc.getSnapshotJSON();
                     chat.server.send($("#txtUserName").val(), myscreenshot, IsRealTime);
                }
                else {
                    //var myscreenshot = lc.getSnapshotJSON();
                    chat.server.send($("#txtUserName").val(), '', IsRealTime);
                }
               
            })

            $.connection.hub.start().done(function () {
                $('#btnSendScreenShot').click(function () {
                    var myscreenshot = lc.getSnapshotJSON();
                    var IsRealTime = $("#txtIsRealTime").val();
                    chat.server.send($("#txtUserName").val(), myscreenshot, IsRealTime);
                   
                });
            });




            $('#btnRealTime').click(function () {
                if ($(this).val() == "Real Time") {
                    $(this).val("Write And Send");
                    $("#txtIsRealTime").val(0);
                    $("#btnSendScreenShot").show();
                    $(this).addClass("realClass");
                }
                else {
                    $("#txtIsRealTime").val(1);
                    $(this).val("Real Time");
                    $("#btnSendScreenShot").hide();
                    $(this).addClass("normalClass");
                };
            });
        });

    </script>
    @Scripts.Render("~/bundles/jquery")
    <!--Reference the SignalR library. -->
    <script src="/Scripts/jquery.signalR-2.2.2.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>
    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("scripts", required: false)
</body>
</html>
